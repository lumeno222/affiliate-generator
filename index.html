<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Affiliate-Link Generator (Embed)</title>
  <style>
    :root{--text:#1f2937;--muted:#6b7280;--brand:#0ea5e9;--brandd:#0284c7;--ring:rgba(14,165,233,.35)}
    *{box-sizing:border-box} body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;color:var(--text)}
    .wrap{max-width:640px;margin:0 auto;padding:14px}
    h1{font-size:20px;margin:0 0 10px} .sub{color:var(--muted);font-size:13px;margin-bottom:12px}
    label{display:block;font-weight:600;margin:12px 0 6px}
    .fld{position:relative}
    input[type=text]{width:100%;padding:12px 12px 12px 42px;border:1px solid #e5e7eb;border-radius:10px;font-size:15px;outline:none;background:#fff}
    input[type=text]:focus{border-color:var(--brand);box-shadow:0 0 0 4px var(--ring)}
    .pf{position:absolute;left:10px;top:50%;transform:translateY(-50%);color:#9aa4b2}
    .row{display:flex;gap:8px;margin-top:10px}
    button{flex:1 0 auto;border:0;border-radius:10px;padding:10px 14px;font-weight:600;cursor:pointer;background:var(--brand);color:#fff}
    button:hover{background:var(--brandd)} button.secondary{background:#0f172a0d;color:#0f172a}
    button:disabled{opacity:.5;cursor:not-allowed}
    .err{color:#ef4444;font-size:13px;display:none;margin-top:6px}
    .out{margin-top:10px;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Courier New",monospace;font-size:13px;border:1px solid #e5e7eb;border-radius:10px;padding:10px;word-break:break-all}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Affiliate-Link Generator</h1>
    <div class="sub">Gib deine Digistore24-ID ein. Der Link wird automatisch erstellt.</div>

    <label for="affId">Digistore24-ID</label>
    <div class="fld">
      <span class="pf">@</span>
      <input id="affId" type="text" placeholder="z. B. maxmustermann23" maxlength="64" autocomplete="username" />
    </div>
    <div id="err" class="err">Ungültige ID. Erlaubt sind a-z, 0-9, Punkt, Unterstrich, Bindestrich.</div>

    <label for="affLink" style="margin-top:10px">Dein Affiliate-Link</label>
    <input id="affLink" type="text" readonly placeholder="—" />

    <div id="preview" class="out" style="display:none"></div>

    <div class="row">
      <button id="genBtn" type="button">Generieren</button>
      <button id="copyBtn" type="button" class="secondary" disabled>Kopieren</button>
      <button id="openBtn" type="button" class="secondary" disabled>Öffnen</button>
    </div>
  </div>

  <script>
    // Default-Basis (kann via ?base=… überschrieben werden)
    const DEFAULT_BASE = "https://www.modeno.biz/startseite/?aff=";

    function getBaseFromQuery() {
      try {
        const q = new URLSearchParams(location.search);
        const b = q.get("base");
        if (!b) return null;
        // nur erlauben, wenn schon mit aff= endet, um Missbrauch zu vermeiden
        const decoded = decodeURIComponent(b);
        if (!/^https?:\/\/[^ ]+aff=$/i.test(decoded)) return null;
        return decoded;
      } catch { return null; }
    }

    const LINK_BASE = getBaseFromQuery() || DEFAULT_BASE;

    const idInput = document.getElementById("affId");
    const linkOut = document.getElementById("affLink");
    const genBtn  = document.getElementById("genBtn");
    const copyBtn = document.getElementById("copyBtn");
    const openBtn = document.getElementById("openBtn");
    const err     = document.getElementById("err");
    const preview = document.getElementById("preview");

    const validId = v => /^[A-Za-z0-9._-]+$/.test(v || "");

    function generate() {
      const raw = (idInput.value || "").trim();
      if (!raw) { err.style.display="block"; err.textContent="Bitte gib deine Digistore24-ID ein."; return; }
      if (!validId(raw)) { err.style.display="block"; err.textContent="Ungültige ID. Erlaubt: a-z, 0-9, ., _, -."; return; }
      err.style.display="none";
      const url = LINK_BASE + encodeURIComponent(raw);
      linkOut.value = url;
      preview.style.display="block";
      preview.textContent = url;
      copyBtn.disabled = false; openBtn.disabled = false;
      try { localStorage.setItem("digistore_aff", raw); } catch {}
    }

    async function copyLink(){
      if (!linkOut.value) return;
      try { await navigator.clipboard.writeText(linkOut.value); }
      catch { linkOut.select(); document.execCommand("copy"); }
    }

    function openLink(){ if (linkOut.value) window.open(linkOut.value, "_blank", "noopener,noreferrer"); }

    genBtn.addEventListener("click", generate);
    copyBtn.addEventListener("click", copyLink);
    openBtn.addEventListener("click", openLink);
    idInput.addEventListener("keydown", e => { if (e.key === "Enter") generate(); });
    idInput.addEventListener("input", ()=>{ copyBtn.disabled=true; openBtn.disabled=true; linkOut.value=""; preview.style.display="none"; err.style.display="none"; });

    // Prefill
    try { const s = localStorage.getItem("digistore_aff"); if (s) { idInput.value = s; generate(); } } catch {}
  </script>
</body>
</html>

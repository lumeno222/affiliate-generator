<script>
document.addEventListener('DOMContentLoaded', function(){
  try{
    const form = document.getElementById('generatorForm') || document.querySelector('form');
    const input = document.getElementById('digistoreId') || document.querySelector('input[type=text]');
    const resultBox = document.getElementById('resultBox') || (() => {
      const b = document.createElement('div'); b.id='resultBox'; b.style.display='none'; document.body.appendChild(b); return b;
    })();
    const resultLink = document.getElementById('resultLink') || (() => {
      const d = document.createElement('div'); d.id='resultLink'; resultBox.appendChild(d); return d;
    })();
    const copyButton = document.getElementById('copyButton') || null;
    const errorMessage = document.getElementById('errorMessage');

    if(!form || !input){
      console.error('Lumify: Form oder Input fehlt', {form, input});
      return;
    }

    function generate(id){
      const link = 'https://www.monefy.biz/lumifyt/?aff=' + encodeURIComponent(id);
      resultLink.textContent = link;
      resultBox.style.display = 'block';
      resultBox.classList && resultBox.classList.add('show');
      console.log('Lumify erzeugt Link:', link);
    }

    form.addEventListener('submit', function(e){
      e.preventDefault();
      const id = input.value.trim();
      if(!id){
        errorMessage && errorMessage.classList && errorMessage.classList.add('show');
        input.focus();
        return;
      }
      errorMessage && errorMessage.classList && errorMessage.classList.remove('show');
      generate(id);
    });

    if(copyButton){
      copyButton.addEventListener('click', function(){
        navigator.clipboard.writeText(resultLink.textContent).then(function(){
          copyButton.textContent = '✓ Kopiert!';
          copyButton.classList.add('copied');
          setTimeout(()=>{ copyButton.textContent = 'In Zwischenablage kopieren'; copyButton.classList.remove('copied'); },2000);
        }).catch(()=> alert('Kopieren fehlgeschlagen — manuell kopieren.'));
      });
    }
  }catch(err){
    console.error('Lumify - Fehler im Script', err);
  }
});
</script>
